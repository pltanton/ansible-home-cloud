---
- name: Copy nginx configuration to remote
  template:
    src: files/nginx.conf
    dest: /media/data/nextcloud/config/nginx.conf

- name: Install nextcloud-db in docker
  docker_container:
    name: nextcloud-db
    image: postgres
    restart: yes
    env: "{{ env }}"
    volumes:
    - "/media/data/nextcloud/db:/var/lib/postgresql/data"
  tags: 
    - start

- name: Install nextcloud in docker
  docker_container:
    name: nextcloud
    image: arm32v7/nextcloud:fpm
    restart: yes
    volumes:
    - "/media/data/nextcloud:/var/www/html"
    links:
    - nextcloud-db
    env: "{{ env }}"
  tags: 
    - start

- name: Install nextcloud-nginx in docker
  docker_container:
    name: nextcloud-nginx
    image: arm32v7/nginx
    restart: yes
    ports:
    - "8081:80"
    volumes:
    - "/media/data/nextcloud/config/nginx.conf:/etc/nginx/nginx.conf:ro"
    volumes_from:
    - nextcloud
    links:
    - nextcloud
    #env: "{{ env }}"
  tags: 
    - start
