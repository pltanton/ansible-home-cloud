- hosts: home-cluster
  user: root
  roles: 
  - syncthing
  - docker
  - common
  - { role: node-exporter, tags: monitoring }
  - { role: node-exporter-thermal-zone, tags: monitoring }
  - vault-luksmounter

- hosts: odroid1
  roles:
  - { role: mosquitto, tags: home-automation }
  - { role: home-assistant, tags: home-automation }
  - { role: hispanico.nginx-revproxy, tags: [nginx, home-automation] }
  - { role: prometheus, tags: monitoring }
  - { role: grafana, tags: monitoring }
  tasks:
  - hostname: { name: odroid1 }
  vars:
    nginx_revproxy_sites:
      default:
        ssl: false
        letsencrypt: false
      torrent.kaliwe.ru:
        domains:
        - torrent.kaliwe.ru
        upstreams:
        - { backend_address: 192.168.20.2, backend_port: 9091 }
        letsencrypt: true
        ssl: false
        letsencrypt_email: "plotnikovanton@gmail.com"
      grafana.kaliwe.ru:
        domains:
        - grafana.kaliwe.ru
        upstreams:
        - { backend_address: 127.0.0.1, backend_port: 3000 }
        letsencrypt: true
        ssl: false
        letsencrypt_email: "plotnikovanton@gmail.com"
      hass.kaliwe.ru:
        domains:
        - hass.kaliwe.ru
        upstreams:
        - { backend_address: 127.0.0.1, backend_port: 8123 }
        letsencrypt: true
        ssl: false
        letsencrypt_email: "plotnikovanton@gmail.com"
      nextcloud.kaliwe.ru:
        domains:
        - nextcloud.kaliwe.ru
        upstreams:
        - { backend_address: 192.168.20.2, backend_port: 8080 }
        letsencrypt: true
        ssl: false
        letsencrypt_email: "plotnikovanton@gmail.com"
      archive.kaliwe.ru:
        domains:
        - archive.kaliwe.ru
        upstreams:
        - { backend_address: 192.168.20.2, backend_port: 40197 }
        letsencrypt: true
        ssl: false
        letsencrypt_email: "plotnikovanton@gmail.com"
      home.kaliwe.ru:
        domains:
        - home.kaliwe.ru
        upstreams:
        - { backend_address: 192.168.88.1, backend_port: 80 }
        letsencrypt: true
        ssl: false
        letsencrypt_email: "plotnikovanton@gmail.com"
      plex.kaliwe.ru:
        domains:
        - plex.kaliwe.ru
        upstreams:
        - { backend_address: 192.168.20.2, backend_port: 32400 }
        letsencrypt: true
        ssl: false
        letsencrypt_email: "plotnikovanton@gmail.com"
  
- hosts: odroid2
  tasks:
  - hostname: { name: odroid2 }
  roles:
    - { role: nextcloud }
    - { role: filebrowser }
    - elboletaire.transmission
    - plex
  vars:
    #transmission_password: "{{ lookup('hashi_vault', 'secret=secret/home-cloud:torrent url=https://vault.kaliwe.ru:8200') }}"
    transmission_password: g9GvwLrjwwURKoKzX2tUTqcbx
    transmission_rpc_auth_required: true
    transmission_rpc_whitelist_enabled: false
    transmission_user: storage
    transmission_download_dir: /media/data/transmsission/downloads
    transmission_watch_dir: /media/data/transmsission/torrents

